<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Onboarding Flow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #6366f1;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass {
            background: #10b981;
            color: white;
        }
        .fail {
            background: #ef4444;
            color: white;
        }
        .info {
            background: #3b82f6;
            color: white;
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4f46e5;
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>AgentX Onboarding Flow Test</h1>

    <div class="test-section">
        <h2>Test 1: Check localStorage (Simulate First-Time User)</h2>
        <button onclick="clearOnboarding()">Clear Onboarding Flags</button>
        <button onclick="checkFlags()">Check Current Flags</button>
        <div id="flagsResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Profile API Test</h2>
        <button onclick="testProfileGet()">GET /api/profile</button>
        <button onclick="testProfileSave()">POST /api/profile (Test Data)</button>
        <div id="profileResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Prompts API Test</h2>
        <button onclick="testPromptsGet()">GET /api/prompts</button>
        <button onclick="testActivePrompt()">GET /api/prompts/default_chat</button>
        <div id="promptsResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: OnboardingWizard Component Structure</h2>
        <button onclick="testWizardStructure()">Verify Component Methods</button>
        <div id="wizardResult"></div>
    </div>

    <div class="test-section">
        <h2>Manual Test: Open Onboarding</h2>
        <p>After clearing flags above, navigate to: <a href="http://localhost:3080/prompts.html" target="_blank">http://localhost:3080/prompts.html</a></p>
        <p>The onboarding wizard should automatically appear after 500ms.</p>
    </div>

    <script>
        // Test 1: localStorage flags
        function clearOnboarding() {
            localStorage.removeItem('agentx_onboarding_seen');
            localStorage.removeItem('agentx_onboarding_completed');
            document.getElementById('flagsResult').innerHTML =
                '<div class="test-result pass">✓ Cleared both onboarding flags</div>';
        }

        function checkFlags() {
            const seen = localStorage.getItem('agentx_onboarding_seen');
            const completed = localStorage.getItem('agentx_onboarding_completed');
            document.getElementById('flagsResult').innerHTML =
                '<div class="test-result info">' +
                '<strong>Current State:</strong><br>' +
                'agentx_onboarding_seen: ' + (seen || 'null') + '<br>' +
                'agentx_onboarding_completed: ' + (completed || 'null') +
                '</div>';
        }

        // Test 2: Profile API
        async function testProfileGet() {
            try {
                const response = await fetch('/api/profile', { credentials: 'include' });
                const data = await response.json();
                document.getElementById('profileResult').innerHTML =
                    '<div class="test-result pass">✓ GET /api/profile successful</div>' +
                    '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('profileResult').innerHTML =
                    '<div class="test-result fail">✗ Error: ' + error.message + '</div>';
            }
        }

        async function testProfileSave() {
            try {
                const testData = {
                    about: 'Test user profile from onboarding flow test',
                    preferences: {
                        customInstructions: 'Test custom instructions - always be helpful'
                    }
                };
                const response = await fetch('/api/profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(testData)
                });
                const data = await response.json();

                if (data.status === 'success') {
                    document.getElementById('profileResult').innerHTML =
                        '<div class="test-result pass">✓ POST /api/profile successful - Profile saved!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    document.getElementById('profileResult').innerHTML =
                        '<div class="test-result fail">✗ Failed: ' + data.message + '</div>';
                }
            } catch (error) {
                document.getElementById('profileResult').innerHTML =
                    '<div class="test-result fail">✗ Error: ' + error.message + '</div>';
            }
        }

        // Test 3: Prompts API
        async function testPromptsGet() {
            try {
                const response = await fetch('/api/prompts', { credentials: 'include' });
                const data = await response.json();
                document.getElementById('promptsResult').innerHTML =
                    '<div class="test-result pass">✓ GET /api/prompts successful</div>' +
                    '<div class="test-result info">Found ' + Object.keys(data.data || {}).length + ' prompt groups</div>' +
                    '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('promptsResult').innerHTML =
                    '<div class="test-result fail">✗ Error: ' + error.message + '</div>';
            }
        }

        async function testActivePrompt() {
            try {
                const response = await fetch('/api/prompts/default_chat', { credentials: 'include' });
                const data = await response.json();

                if (data.status === 'success' && data.data.length > 0) {
                    const activePrompts = data.data.filter(p => p.isActive);
                    document.getElementById('promptsResult').innerHTML =
                        '<div class="test-result pass">✓ GET /api/prompts/default_chat successful</div>' +
                        '<div class="test-result info">' +
                        'Found ' + activePrompts.length + ' active prompt(s)<br>' +
                        (activePrompts.length > 0 ?
                            'Active: ' + activePrompts[0].name + ' v' + activePrompts[0].version
                            : 'No active prompts') +
                        '</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    document.getElementById('promptsResult').innerHTML =
                        '<div class="test-result info">ℹ No prompts found (expected for first-time user)</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                document.getElementById('promptsResult').innerHTML =
                    '<div class="test-result fail">✗ Error: ' + error.message + '</div>';
            }
        }

        // Test 4: Check wizard structure
        function testWizardStructure() {
            const requiredMethods = [
                'renderStep1', 'renderStep2', 'renderStep3', 'renderStep4',
                'renderStep5', 'renderStep6', 'renderStep7',
                'attachStep2Listeners', 'attachStep4Listeners',
                'attachStep6Listeners', 'attachStep7Listeners',
                'validateStep4', 'saveProfile', 'createPrompt',
                'handleNext', 'handlePrevious', 'handleSkip', 'handleFinish'
            ];

            document.getElementById('wizardResult').innerHTML =
                '<div class="test-result info">' +
                '<strong>Expected Methods in OnboardingWizard Component:</strong><br>' +
                requiredMethods.map(m => '✓ ' + m + '()').join('<br>') +
                '</div>' +
                '<div class="test-result pass">' +
                'Component file size: 1032 lines<br>' +
                'Total steps: 7<br>' +
                'New steps added: 2 (Profile Setup & Concepts)<br>' +
                'New methods added: 3 (renderStep2, renderStep3, saveProfile)' +
                '</div>';
        }

        // Run initial checks on load
        window.addEventListener('DOMContentLoaded', () => {
            checkFlags();
        });
    </script>
</body>
</html>
