<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgentX â€¢ DataAPI Tools</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="css/sbqc.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="page">
    <div class="main-content">
      <header class="hero">
        <div class="hero-content">
          <div class="eyebrow">AgentX â€¢ Tool console</div>
          <div class="title-row">
            <h1>DataAPI Tools</h1>
            <a class="ghost small" href="/">Chat</a>
            <a class="ghost small" href="/analytics.html">Analytics</a>
            <a class="ghost small" href="/metrics.html">ðŸ“Š Metrics</a>
            <a class="ghost small" href="/dataapi.html" class="active">ðŸ§° Data Tools</a>
            <a class="ghost small" href="/dashboard.html">Dashboard</a>
            <a class="ghost small" href="/file-browser.html">Files</a>
            <a class="ghost small" href="/databases.html">Databases</a>
          </div>
          <p class="lede">Storage scans, file search/duplicates, exports, and live data via DataAPI (server-side proxy).</p>
        </div>
      </header>

      <main class="layout" style="grid-template-columns: 1fr;">

        <!-- Legacy Views Links -->
        <section class="panel" style="grid-column: 1 / -1;">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Navigation</p>
              <h2>Legacy Views</h2>
            </div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
             <a href="/dashboard.html" style="text-decoration: none; color: inherit;">
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                   <h3 style="margin-top: 0;">Dashboard</h3>
                   <p style="margin-bottom: 0; font-size: 0.9rem; opacity: 0.7;">Main dashboard with world map and event feed.</p>
                </div>
             </a>
             <a href="/databases.html" style="text-decoration: none; color: inherit;">
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                   <h3 style="margin-top: 0;">Databases</h3>
                   <p style="margin-bottom: 0; font-size: 0.9rem; opacity: 0.7;">Manage MongoDB collections and documents.</p>
                </div>
             </a>
             <a href="/file-browser.html" style="text-decoration: none; color: inherit;">
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                   <h3 style="margin-top: 0;">File Browser</h3>
                   <p style="margin-bottom: 0; font-size: 0.9rem; opacity: 0.7;">Browse and manage server files.</p>
                </div>
             </a>
             <a href="/ai-control.html" style="text-decoration: none; color: inherit;">
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                   <h3 style="margin-top: 0;">AI Control</h3>
                   <p style="margin-bottom: 0; font-size: 0.9rem; opacity: 0.7;">Chat with AI models.</p>
                </div>
             </a>
             <a href="/n8n-test.html" style="text-decoration: none; color: inherit;">
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                   <h3 style="margin-top: 0;">n8n Test</h3>
                   <p style="margin-bottom: 0; font-size: 0.9rem; opacity: 0.7;">Test n8n webhooks.</p>
                </div>
             </a>
          </div>
        </section>
        
        <!-- Earth Explorer Panel -->
        <section class="panel" style="grid-column: 1 / -1;">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Visualization</p>
              <h2>Earth Explorer</h2>
            </div>
            <div class="controls">
               <div id="mqtt-status" class="pill inline">MQTT: Disconnected</div>
            </div>
          </div>
          <div id="mapDiv" style="width: 100%; height: 800px; overflow: hidden; background: #000; display: flex; justify-content: center; align-items: center;">
            <!-- p5.js canvas will be injected here -->
          </div>
          <div style="display:none;">
             <canvas id="pressureChart"></canvas>
             <span id="lat"></span><span id="lon"></span><span id="pressure"></span>
          </div>
        </section>

        <!-- n8n Integration Panel -->
        <section class="panel" style="grid-column: 1 / -1;">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Automation</p>
              <h2>n8n Integration</h2>
            </div>
          </div>
          <div class="composer-actions">
            <button class="ghost" onclick="fetch('/api/v1/n8n/health').then(r=>r.json()).then(d=>alert(JSON.stringify(d)))">Check Health</button>
            <button class="ghost" onclick="fetch('/api/v1/n8n/nas/files?limit=5').then(r=>r.json()).then(d=>alert('Found ' + d.results + ' files'))">List NAS Files</button>
            <button class="ghost" onclick="fetch('/api/v1/n8n/nas/scan').then(r=>r.json()).then(d=>alert(JSON.stringify(d)))">Trigger Scan</button>
          </div>
          <div class="note">
            These buttons trigger the DataAPI endpoints used by n8n. To trigger actual n8n workflows, configure webhooks in n8n.
          </div>
        </section>

        <section class="panel" style="grid-column: 1 / -1;">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Storage</p>
              <h2>Scan</h2>
            </div>
            <div class="controls">
              <button class="ghost small" id="refreshScansBtn">Refresh scans</button>
            </div>
          </div>

          <div class="field">
            <label>Roots (comma-separated)</label>
            <input id="scanRoots" type="text" placeholder="/mnt/smb/Media,/mnt/smb/Datalake" />
          </div>
          <div class="field">
            <label>Extensions (comma-separated)</label>
            <input id="scanExt" type="text" placeholder="jpg,png,mp4,mkv" />
          </div>
          <div class="field">
            <label>Batch size</label>
            <input id="scanBatch" type="number" value="1000" min="1" max="50000" />
          </div>

          <div class="composer-actions" style="margin-top: 12px;">
            <button class="primary" id="startScanBtn">Start scan</button>
            <button class="ghost small" id="stopScanBtn" disabled>Stop scan</button>
            <div style="flex:1;"></div>
            <div class="pill inline">scan_id <span id="activeScanId">(none)</span></div>
          </div>

          <div class="note" id="scanStatus">Idle.</div>

          <div class="field" style="margin-top: 14px;">
            <label>Recent scans</label>
            <div class="log-window" id="scansList" style="max-height: 240px;"></div>
          </div>
        </section>

        <section class="panel" style="grid-column: 1 / -1;">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Files</p>
              <h2>Search & Duplicates</h2>
            </div>
            <div class="controls">
              <button class="ghost small" id="loadDuplicatesBtn">Duplicates</button>
              <button class="ghost small" id="loadStatsBtn">Stats</button>
            </div>
          </div>

          <div class="composer" style="margin-top: 0;">
            <textarea id="searchQuery" rows="2" placeholder="Search filesâ€¦"></textarea>
            <div class="composer-actions">
              <button class="primary" id="searchBtn">Search</button>
            </div>
          </div>

          <div class="note" id="filesStatus">Idle.</div>

          <div class="field" style="margin-top: 14px;">
            <label>Results</label>
            <div class="log-window" id="filesResults" style="max-height: 320px;"></div>
          </div>
        </section>

        <section class="panel" style="grid-column: 1 / -1;">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Exports</p>
              <h2>Generated Reports</h2>
            </div>
            <div class="controls">
              <button class="ghost small" id="refreshExportsBtn">Refresh exports</button>
            </div>
          </div>

          <div class="note" id="exportsStatus">Idle.</div>
          <div class="field" style="margin-top: 14px;">
            <label>Exports</label>
            <div class="log-window" id="exportsList" style="max-height: 240px;"></div>
          </div>
        </section>

        <section class="panel" style="grid-column: 1 / -1;">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Live</p>
              <h2>ISS & Quakes</h2>
            </div>
            <div class="controls">
              <button class="ghost small" id="refreshLiveBtn">Refresh</button>
            </div>
          </div>

          <div class="note" id="liveStatus">Idle.</div>
          <div class="field" style="margin-top: 14px;">
            <label>Live data</label>
            <div class="log-window" id="liveResults" style="max-height: 240px;"></div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script src="dataapi.js" defer></script>
  <script src="js/Tools.js"></script>
  <script>
    // Mock mqttConfig to prevent errors
    var mqttConfig = { brokerUrl: '', issTopic: '', pressureTopic: '' };
  </script>
  <script src="js/live-data.js"></script>
</body>
</html>
