<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentX â€¢ Operations Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <nav class="top-nav">
        <a href="index.html"><i class="fas fa-comments"></i> Chat</a>
        <a href="dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Operations</a>
        <a href="n8n-monitor.html"><i class="fas fa-network-wired"></i> n8n Monitor</a>
    <a href="benchmark.html"><i class="fas fa-network-wired"></i> n8n Monitor</a>
        <a href="analytics.html"><i class="fas fa-chart-line"></i> Analytics</a>
    </nav>
    <div class="bg-grid"></div>
    <div class="page ops-page" style="padding-top: 80px;">
        
        <!-- Header -->
        <header class="ops-header">
            <div>
                <div class="eyebrow">AgentX â€¢ Operations</div>
                <h1><i class="fas fa-tachometer-alt"></i><span class="title-separator"></span>Operations Center</h1>
                <p class="lede">Monitor health, trigger workflows, and track system metrics â€” all in one view.</p>
            </div>
        </header>

        <!-- Health Strip -->
        <div class="health-strip">
            <span class="health-strip-title"><i class="fas fa-heartbeat"></i> System Health</span>
            <div class="health-strip-item" id="health-agentx">
                <span class="dot"></span>
                <span>AgentX</span>
            </div>
            <div class="health-strip-item" id="health-mongodb">
                <span class="dot"></span>
                <span>MongoDB</span>
            </div>
            <div class="health-strip-item" id="health-dataapi">
                <span class="dot"></span>
                <span>DataAPI</span>
            </div>
            <div class="health-strip-item" id="health-ollama">
                <span class="dot"></span>
                <span>Ollama</span>
            </div>
            <div class="health-strip-item" id="health-n8n">
                <span class="dot"></span>
                <span>n8n</span>
            </div>
            <div class="uptime-info">
                <i class="fas fa-clock"></i>
                <span>Uptime:</span>
                <span class="value" id="sys-uptime">â€”</span>
            </div>
        </div>

        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card" data-tooltip="Percentage of embedding cache hits vs misses. Higher is better - means fewer expensive API calls to the embedding service.">
                <div class="metric-label">Cache Hit Rate</div>
                <div class="metric-value">
                    <span class="status-dot healthy" id="cacheStatus"></span>
                    <span id="cache-hit-rate">0%</span>
                </div>
                <div class="metric-bar"><div class="metric-fill" id="cacheBar" style="width: 0%"></div></div>
                <div class="metric-detail"><span id="cacheHits">0</span> hits / <span id="cacheMisses">0</span> miss</div>
            </div>
            <div class="metric-card" data-tooltip="Total number of documents stored across all MongoDB collections (conversations, configs, user profiles, etc.)">
                <div class="metric-label">DB Documents</div>
                <div class="metric-value">
                    <span class="status-dot healthy"></span>
                    <span id="db-total-docs">0</span>
                </div>
                <div class="metric-detail">Across all collections</div>
            </div>
            <div class="metric-card" data-tooltip="Active database connections out of maximum pool size. Monitor to detect connection leaks or pool exhaustion.">
                <div class="metric-label">Connections</div>
                <div class="metric-value">
                    <span class="status-dot healthy" id="connStatus"></span>
                    <span id="connActive">0</span>/<span id="connMax">0</span>
                </div>
                <div class="metric-bar"><div class="metric-fill" id="connBar" style="width: 0%"></div></div>
                <div class="metric-detail"><span id="connAvail">0</span> available</div>
            </div>
            <div class="metric-card" data-tooltip="Node.js heap memory usage. Shows V8 JavaScript heap allocation. Warning at >80%, critical at >90%.">
                <div class="metric-label">Memory (Heap)</div>
                <div class="metric-value">
                    <span class="status-dot healthy" id="sysStatus"></span>
                    <span id="sys-mem">0 MB</span>
                </div>
                <div class="metric-bar"><div class="metric-fill" id="sysBar" style="width: 0%"></div></div>
                <div class="metric-detail">of <span id="sysTotalMem">0</span></div>
            </div>
        </div>

        <!-- Main Grid: 3 Sections -->
        <div class="ops-grid">
            

            <!-- Section 3: System Metrics + Collections -->
            <div class="section-card">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Metrics</h2>
                    <button class="btn-sm" id="refreshMetricsBtn"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div class="section-body">
                    <div class="metrics-grid">
                        <div class="metric-card" data-tooltip="Percentage of embedding cache hits vs misses. Higher is better - means fewer expensive API calls to the embedding service.">
                            <div class="metric-label">Cache</div>
                            <div class="metric-value">
                                <span class="status-dot healthy" id="cacheStatus"></span>
                                <span id="cacheHitRate">0%</span>
                            </div>
                            <div class="metric-bar"><div class="metric-fill" id="cacheBar" style="width: 0%"></div></div>
                            <div class="metric-detail"><span id="cacheHits">0</span> hits / <span id="cacheMisses">0</span> miss</div>
                        </div>
                        <div class="metric-card" data-tooltip="Active database connections out of maximum pool size. Monitor to detect connection leaks or pool exhaustion.">
                            <div class="metric-label">Connections</div>
                            <div class="metric-value">
                                <span class="status-dot healthy" id="connStatus"></span>
                                <span id="connActive">0</span>/<span id="connMax">0</span>
                            </div>
                            <div class="metric-bar"><div class="metric-fill" id="connBar" style="width: 0%"></div></div>
                            <div class="metric-detail"><span id="connAvail">0</span> available</div>
                        </div>
                        <div class="metric-card" data-tooltip="Node.js heap memory usage. Shows V8 JavaScript heap allocation. Warning at >80%, critical at >90%.">
                            <div class="metric-label">Heap</div>
                            <div class="metric-value">
                                <span class="status-dot healthy" id="sysStatus"></span>
                                <span id="heapUsed">0 MB</span>
                            </div>
                            <div class="metric-bar"><div class="metric-fill" id="sysBar" style="width: 0%"></div></div>
                            <div class="metric-detail">of <span id="heapTotal">0 MB</span></div>
                        </div>
                        <div class="metric-card" data-tooltip="Node.js version and platform information for the running AgentX server process.">
                            <div class="metric-label">Node</div>
                            <div class="metric-value" id="sysNode" style="font-size: 14px;">v18+</div>
                            <div class="metric-detail" id="sysPlatform">Linux</div>
                        </div>
                    </div>
                </div>

                <!-- Collections Sub-section -->
                <div class="section-header" style="margin-top: 0; border-top: 1px solid var(--panel-border);">
                    <h2><i class="fas fa-database"></i> Collections</h2>
                </div>
                <div class="section-body">
                    <div class="collections-list" id="collections-list">
                        <div class="collection-item">
                            <span style="color: var(--muted);">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- DataAPI Scans Sub-section -->
                <div class="section-header" style="margin-top: 0; border-top: 1px solid var(--panel-border);">
                    <h2><i class="fas fa-hdd"></i> DataAPI Scans</h2>
                    <button class="btn-sm" id="refreshScansBtn" title="Refresh Scans"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div class="section-body">
                    <div class="scans-list" id="scans-list" style="max-height: 200px; overflow-y: auto;">
                        <div class="scan-item"><span style="color: var(--muted);">Loading...</span></div>
                    </div>
                </div>


            </div>

            <!-- Section 2: n8n Webhook Trigger -->
            <div class="section-card">
                <div class="section-header">
                    <h2><i class="fas fa-bolt"></i> n8n Webhook</h2>
                    <button class="btn-sm" id="n8nHelpBtn" title="Show help"><i class="fas fa-question-circle"></i></button>
                </div>
                <div class="help-banner" id="n8nHelpBanner" style="display: none;">
                    <div class="help-content">
                        <strong><i class="fas fa-info-circle"></i> n8n Webhook Testing</strong>
                        <p>Trigger n8n workflows directly from this dashboard. Select a pre-configured workflow or enter a custom webhook UUID/URL.</p>
                        <ul>
                            <li><strong>N1.3 Ops AI Diagnostic:</strong> Diagnose system health using AgentX (Ops Persona)</li>
                            <li><strong>N2.3 RAG Ingestion:</strong> Trigger RAG ingestion for documents</li>
                            <li><strong>N3.2 AI Gateway:</strong> Gateway for external tools to query AgentX</li>
                            <li><strong>N5.1 Feedback Analysis:</strong> Analyze feedback and optimize prompts</li>
                            <li><strong>Custom:</strong> Use any n8n webhook UUID or full URL</li>
                        </ul>
                        <p class="help-note">ðŸ’¡ <strong>Tip:</strong> Find webhook IDs in n8n at <a href="https://n8n.specialblend.icu" target="_blank">n8n.specialblend.icu</a></p>
                    </div>
                </div>
                <div class="section-body">
                    <div class="webhook-form">
                        <div class="field-group">
                            <label>Workflow <span class="field-help" title="Select a pre-configured workflow or choose Custom to enter your own webhook"><i class="fas fa-info-circle"></i></span></label>
                            <select id="workflowSelector">
                                <option value="n1-1">N1.1 System Health Check</option>
                                <option value="n1-3">N1.3 Ops AI Diagnostic</option>
                                <option value="n2-1">N2.1 NAS File Scanner</option>
                                <option value="n2-2">N2.2 NAS Full/Other Scan</option>
                                <option value="n2-3">N2.3 RAG Ingestion</option>
                                <option value="n3-1">N3.1 Model Health Monitor</option>
                                <option value="n3-2">N3.2 AI Gateway</option>
                                <option value="n5-1">N5.1 Feedback Analysis</option>
                                <option value="custom">Custom Webhook...</option>
                            </select>
                            <div class="field-hint" id="workflowUrlDisplay" style="margin-top: 4px; font-family: monospace; color: var(--accent); font-size: 12px;"></div>
                            <div class="workflow-description" id="workflowDescription">Processes email using AI agent with Gmail integration</div>
                        </div>
                        <div class="field-group" id="customWebhookDiv" style="display: none;">
                            <label>Custom URL <span class="field-help" title="Enter n8n webhook UUID (e.g., c1deca83-ecb4-...) or full URL"><i class="fas fa-info-circle"></i></span></label>
                            <input type="text" id="customWebhookId" placeholder="e.g., c1deca83-ecb4-48ad-b485-59195cee9a61">
                            <small class="field-hint">Enter UUID or full webhook URL from n8n</small>
                        </div>
                        <div class="field-group">
                            <label>Payload (JSON) <span class="field-help" title="JSON data to send to the webhook. Edit as needed for your test."><i class="fas fa-info-circle"></i></span></label>
                            <textarea id="webhookPayload" rows="4">{
  "event": "test_trigger",
  "source": "ops-center"
}</textarea>
                            <div class="payload-actions">
                                <button class="btn-xs" id="formatJsonBtn" title="Format JSON"><i class="fas fa-align-left"></i> Format</button>
                                <button class="btn-xs" id="examplePayloadBtn" title="Load example payload"><i class="fas fa-lightbulb"></i> Example</button>
                                <button class="btn-xs" id="clearPayloadBtn" title="Clear payload"><i class="fas fa-eraser"></i> Clear</button>
                            </div>
                        </div>
                        <button class="btn-sm btn-primary" id="triggerWebhookBtn" style="width: 100%; justify-content: center;">
                            <i class="fas fa-paper-plane"></i> Trigger Webhook
                        </button>
                        
                        <div class="result-header" id="resultHeader">
                            <span class="result-label">Response</span>
                            <div class="payload-actions">
                                <button class="btn-xs" id="expandResultBtn" title="Expand view"><i class="fas fa-expand"></i></button>
                                <button class="btn-xs" id="copyResultBtn" title="Copy to clipboard"><i class="fas fa-copy"></i></button>
                            </div>
                        </div>
                        <div class="webhook-result" id="triggerResult"></div>
                    </div>
                </div>

                <!-- RAG Ingestion Sub-section -->
                <div class="section-header" style="margin-top: 0; border-top: 1px solid var(--panel-border);">
                    <h2><i class="fas fa-book"></i> RAG Ingestion</h2>
                </div>
                <div class="section-body">
                    <div class="field-group">
                        <label>Target Directory <span class="field-help" title="Directory on server to scan for documents"><i class="fas fa-info-circle"></i></span></label>
                        <input type="text" id="ragTargetDir" value="/mnt/datalake/RAG" placeholder="/mnt/datalake/RAG">
                    </div>
                    <button class="btn-sm btn-primary" id="triggerRagBtn" style="width: 100%; justify-content: center;">
                        <i class="fas fa-file-import"></i> Trigger Ingestion
                    </button>
                    <div id="ragResult" style="margin-top: 8px; font-size: 11px; color: var(--muted); display: none;"></div>
                </div>
            </div>

            <!-- Section 3: System Events -->
            <div class="section-card" style="grid-column: 1 / -1;">
                <div class="section-header">
                    <h2><i class="fas fa-stream"></i> Recent Events</h2>
                    <button class="btn-sm" id="refreshEventsBtn"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div class="section-body">
                    <div class="events-list" id="system-events-list">
                        <div class="event-row">
                            <div class="event-content">
                                <div class="event-message" style="color: var(--muted);">Loading events...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <!-- Scan Report Modal -->
    <div id="scanReportModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
        <div class="modal-content" style="background: #1e293b; padding: 24px; border-radius: 12px; width: 80%; max-width: 800px; max-height: 80vh; overflow-y: auto; border: 1px solid var(--panel-border);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 style="margin: 0; font-size: 20px;">Scan Report</h2>
                <button class="btn-sm" id="closeScanReportBtn"><i class="fas fa-times"></i></button>
            </div>
            <pre id="scanReportContent" style="background: rgba(0,0,0,0.3); padding: 16px; border-radius: 8px; overflow-x: auto; font-family: monospace; font-size: 12px; color: #e2e8f0;"></pre>
        </div>
    </div>

    <script type="module" src="/js/dashboard.js"></script>
</body>

</html>
