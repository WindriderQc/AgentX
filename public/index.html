<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgentX â€¢ Ollama Control</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-grid"></div>
  <div class="page history-hidden">
    <aside class="sidebar">
      <div class="sidebar-head">
        <h2>History</h2>
        <div class="sidebar-actions">
          <button id="newChatBtn" class="icon-btn" title="New Chat">+</button>
          <button id="closeHistoryBtn" class="icon-btn" title="Hide history">Ã—</button>
        </div>
      </div>
      <div id="historyList" class="history-list">
        <!-- History items will be injected here -->
      </div>
    </aside>

    <div class="main-content app-layout">
    <header class="hero">
      <div class="hero-content">
        <div class="eyebrow">GraphysX â€¢ Local agents</div>
        <div class="title-row">
          <h1>AgentX Control</h1>
          <span class="status-chip" id="statusChip">Idle</span>
<<<<<<< Updated upstream
          <button id="toggleHistoryBtn" class="ghost small">Hide history</button>
          <button id="profileBtn" class="ghost small">User Profile</button>
          <a class="ghost small" href="/analytics.html">Analytics</a>
          <a class="ghost small" href="/metrics.html">ðŸ“Š Metrics</a>
          <a class="ghost small" href="/dataapi.html">ðŸ§° Data Tools</a>
          <a class="ghost small" href="/n8n-control.html">âš¡ n8n Ops</a>
          <button id="loginBtn" class="ghost small" style="display: none;">Login</button>
          <div id="userMenu" class="user-menu" style="display: none;">
            <span id="userName" class="user-name"></span>
            <button id="logoutBtn" class="ghost small">Logout</button>
          </div>
=======
          <!-- Navigation will be injected here -->
          <nav class="agentx-nav"></nav>
>>>>>>> Stashed changes
        </div>

        <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center;">
             <button id="toggleHistoryBtn" class="ghost small">Show history</button>
             <button id="profileBtn" class="ghost small">User Profile</button>
             <button id="loginBtn" class="ghost small" style="display: none;">Login</button>
             <div id="userMenu" class="user-menu" style="display: none;">
                <span id="userName" class="user-name"></span>
                <button id="logoutBtn" class="ghost small">Logout</button>
             </div>
        </div>

        <p class="lede">
          Rebuilt AI control surface wired to the AgentX chat, memory, and feedback APIs. Pick a model, tune parameters, and
          manage the session profile that the assistant will remember.
        </p>
      </div>
    </header>

    <main class="layout">
      <section class="panel chat">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Conversation</p>
            <h2>AI Dialogue</h2>
          </div>
          <div class="controls">
            <div class="pill inline">
              <span class="label">Messages</span>
              <strong id="statMessages">0</strong>
            </div>
            <button class="ghost small" id="toggleLogBtn">Show session log</button>
          </div>
        </div>

        <div class="chat-window" id="chatWindow">
          <div class="bubble assistant">
            <div class="meta">AgentX</div>
            <p>Hello! Iâ€™m online. Pick a model, then ask away.</p>
          </div>
        </div>

        <div class="composer">
          <div class="quick-actions">
            <button class="chip" data-quick="What can you help me with?">Help</button>
            <button class="chip" data-quick="Summarize recent events.">Summary</button>
            <button class="chip" data-quick="List available tools.">Tools</button>
            <button class="chip" data-quick="Brainstorm next steps for my project.">Brainstorm</button>
          </div>
          <textarea id="messageInput" rows="3" placeholder="Type to your agent..."></textarea>
          <div class="composer-actions">
            <button class="icon-btn" id="micBtn" title="Voice Input" aria-label="Voice Input" aria-pressed="false">ðŸŽ¤</button>
            <div class="flex-spacer"></div>
            <button class="ghost small" id="clearBtn">Clear chat</button>
            <button class="primary" id="sendBtn">Send</button>
          </div>
        </div>

        <div class="log-panel collapsed">
          <div class="panel-head">
            <div>
              <p class="eyebrow">Session log</p>
              <h3>Recent exchanges</h3>
            </div>
            <div class="pill inline">Thread <span id="threadId"></span></div>
          </div>
          <div class="log-window" id="logWindow"></div>
        </div>
      </section>

      <aside class="panel config">
        <div class="panel-head tight">
          <div>
            <p class="eyebrow">Models & memory</p>
            <h2>Configuration</h2>
          </div>
        </div>

        <div class="field">
          <label>Target host</label>
          <div class="input-row">
            <select id="hostInput" style="flex: 1;">
              <option value="localhost">localhost</option>
              <option value="127.0.0.1">127.0.0.1</option>
              <option value="192.168.2.12">192.168.2.12</option>
              <option value="192.168.2.99">192.168.2.99</option>
            </select>
            <input type="text" id="portInput" class="w-96" value="11434">
          </div>
        </div>

        <div class="field">
          <label>Model</label>
          <div class="input-row">
            <select id="modelSelect" style="flex: 1;">
              <option value="">Load available modelsâ€¦</option>
            </select>
            <button class="icon-btn" id="refreshModels" title="Refresh models from Ollama">â†»</button>
          </div>
          <div class="hint">Models are pulled from the selected Ollama host.</div>
        </div>

        <div class="note" id="feedback">Waiting for configuration.</div>

        <div class="field inline-toggle">
          <label>Streaming</label>
          <label class="switch">
            <input type="checkbox" id="streamToggle" checked>
            <span class="slider"></span>
          </label>
          <div class="hint">Stream responses in real-time (recommended for thinking models).</div>
        </div>

        <div class="field inline-toggle">
          <label>Enable RAG</label>
          <label class="switch">
            <input type="checkbox" id="ragToggle">
            <span class="slider"></span>
          </label>
          <div class="hint">Retrieve context from vector store.</div>
        </div>

        <div class="field inline-toggle">
          <label>TTS Output</label>
          <label class="switch">
            <input type="checkbox" id="ttsToggle">
            <span class="slider"></span>
          </label>
          <div class="hint">Read responses aloud (Browser TTS).</div>
        </div>

        <div class="field inline-toggle">
          <label>Show Message Stats</label>
          <label class="switch">
            <input type="checkbox" id="statsToggle" checked>
            <span class="slider"></span>
          </label>
          <div class="hint">Display token usage and timing for each message.</div>
        </div>

        <div class="field">
          <label>System prompt</label>
          <textarea id="systemPrompt" rows="3">You are AgentX, a concise and capable local assistant. Keep answers brief and actionable.</textarea>
        </div>

        <div class="collapsible-section">
          <div class="section-header" id="tuningHeader">
            <h3>Model Tuning Parameters</h3>
            <span class="toggle-icon">â–¼</span>
          </div>
          <div class="section-content hidden" id="tuningContent">

        <div class="options-grid">
          <div class="field">
            <label>Temperature</label>
            <input type="range" id="temperature" min="0" max="2" step="0.05" value="0.7">
            <div class="value" data-for="temperature">0.7</div>
          </div>
          <div class="field">
            <label>Top P</label>
            <input type="range" id="topP" min="0" max="1" step="0.01" value="0.9">
            <div class="value" data-for="topP">0.9</div>
          </div>
          <div class="field">
            <label>Top K</label>
            <input type="number" id="topK" value="64" min="1" max="32000">
          </div>
          <div class="field">
            <label>Context (tokens)</label>
            <input type="number" id="numCtx" value="4096" min="256" max="32000" step="256">
          </div>
          <div class="field">
            <label>Repeat penalty</label>
            <input type="number" id="repeatPenalty" value="1.05" min="0" max="2" step="0.01">
          </div>
          <div class="field">
            <label>Presence penalty</label>
            <input type="number" id="presencePenalty" value="0" min="-2" max="2" step="0.01">
          </div>
          <div class="field">
            <label>Frequency penalty</label>
            <input type="number" id="frequencyPenalty" value="0" min="-2" max="2" step="0.01">
          </div>
          <div class="field">
            <label>Num predict</label>
            <input type="number" id="numPredict" value="256" min="16" max="4096" step="16">
          </div>
          <div class="field">
            <label>Seed</label>
            <input type="number" id="seed" value="" placeholder="random">
          </div>
          <div class="field">
            <label>Stop sequences</label>
            <input type="text" id="stopSequences" placeholder="e.g. ###,END">
          </div>
          <div class="field">
            <label>Keep alive</label>
            <input type="text" id="keepAlive" placeholder="e.g. 30s or -1">
            <div class="hint">Keep the model warm between calls.</div>
          </div>
        </div>

        <div class="action-row">
          <button class="primary full" id="saveDefaults">Save defaults</button>
        </div>

          </div>
        </div>
      </aside>
    </main>
    </div> <!-- End main-content -->
  </div>

  <!-- Profile Modal -->
  <div id="profileModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>User Profile & Memory</h2>
        <button id="closeProfileBtn" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="field">
          <label>About You (Memory)</label>
          <div class="hint">Facts the agent should remember about you (e.g., job, interests, background).</div>
          <textarea id="userAbout" rows="5" placeholder="I am a software engineer interested in AI..."></textarea>
        </div>
        <div class="field">
          <label>Preferred Language</label>
          <input type="text" id="memoryLanguage" placeholder="English">
        </div>
        <div class="field">
          <label>Role / Context</label>
          <input type="text" id="memoryRole" placeholder="e.g. Product manager focusing on UX">
        </div>
        <div class="field">
          <label>Response Style</label>
          <textarea id="memoryStyle" rows="2" placeholder="Concise, decisive, include next steps."></textarea>
        </div>
        <div class="field">
          <label>Custom Instructions</label>
          <div class="hint">How the agent should behave (e.g., always be concise).</div>
          <textarea id="userInstructions" rows="3" placeholder="Be brief and professional."></textarea>
        </div>
        <div class="hint">All profile data is saved to your AgentX database and persisted across conversations.</div>
        <div class="action-row">
          <button class="ghost" id="resetProfileBtn">Reset</button>
          <button class="primary" id="saveProfileBtn">Save Profile</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { injectNav } from '/js/components/nav.js';
    injectNav('chat');
  </script>
  <script src="/js/chat.js"></script>
</body>
</html>
